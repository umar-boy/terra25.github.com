<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>üåç Zenit ‚Äî AI Defender of the Earth</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<style>
body { background-color: #0a0a1a; color: #fff; font-family: 'Segoe UI', sans-serif; }
.card { background: #141432; border: 2px solid #00ffcc; border-radius: 15px; transition: transform 0.3s; }
.card:hover { transform: scale(1.05); box-shadow: 0 0 30px #00ffcc; }
#map { height: 450px; border-radius: 15px; margin-top: 20px; border: 2px solid #00ffcc; }
.chat-box { max-height: 300px; overflow-y: auto; border: 2px solid #00ffcc; border-radius: 10px; padding: 10px; background: rgba(20,20,40,0.9); }
.user-msg { text-align: right; color: #00ffd5; margin: 5px 0; font-weight: bold; }
.bot-msg { text-align: left; color: #03cd1b; margin: 5px 0; }
.alert-custom { position: fixed; top: 20px; right: 20px; z-index: 9999; font-weight: bold; }
.btn-glow { box-shadow: 0 0 15px #00ffcc; transition: 0.3s; }
.btn-glow:hover { box-shadow: 0 0 25px #00ffd5; }
#eventLog { max-height: 250px; overflow-y: auto; background: rgba(15,15,30,0.9); border: 2px solid #00ffcc; border-radius: 10px; padding: 10px; }
.event-item { border-bottom: 1px solid #00ffcc33; padding: 5px 0; font-size: 0.95rem; }
.notification-toggle { display: inline-block; width: 60px; height: 30px; background: #444; border-radius: 30px; position: relative; cursor: pointer; margin-left: 10px; }
.notification-toggle::before { content: ""; position: absolute; top: 4px; left: 4px; width: 22px; height: 22px; background: white; border-radius: 50%; transition: 0.3s; }
.notification-toggle.active { background: #00ffcc; box-shadow: 0 0 15px #00ffcc; }
.notification-toggle.active::before { transform: translateX(30px); background: #000; }
#alarmLight { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events:none; opacity:0; z-index:9998; }
@media (max-width:768px){
  #map { height: 350px; }
  .chat-box { max-height:200px; }
}
</style>
</head>
<body class="container py-5">

<nav class="navbar navbar-expand-lg navbar-dark fixed-top" style="background-color: blue;">
  <div class="container">
    <a class="navbar-brand" href="#">üåç Terra25</a>
  </div>
</nav>
<nav class="navbar navbar-expand-lg navbar-dark fixed-top" style="background-color: blue;">
  <div class="container">
    <a class="navbar-brand" href="#">üåç Terra25</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav"><span class="navbar-toggler-icon"></span></button>
    <div class="collapse navbar-collapse" id="nav">
      <ul class="navbar-nav ms-auto">
          <li class="nav-item"><a class="nav-link" href="–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.html" style="color: #ffffff;">Zenit</a></li>
        <li class="nav-item"><a class="nav-link" href="#home" style="color: #ffffff;">home</a></li>
        <li class="nav-item"><a class="nav-link" href="#history" style="color: #ffffff;">history</a></li>
        <li class="nav-item"><a class="nav-link" href="#space" style="color: #fffcfc;">space</a></li>
        <li class="nav-item"><a class="nav-link" href="#solar" style="color: #ffffff;">solar</a></li>
        <li class="nav-item"><a class="nav-link" href="#blog" style="color: #ffffff;">blog</a></li>
        <li class="nav-item"><a class="nav-link" href="contact.html" style="color: #ffffff;">about us</a></li>
      </ul>
    </div>
  </div>
</nav>
<header>
<h1 class="text-center mb-4 text-info animate__animated animate__fadeInDown">üåç Zenit ‚Äî AI Defender of the Earth</h1>

<div class="text-center mb-3">
  <label>üîî Notifications:</label>
  <div id="notifyToggle" class="notification-toggle"></div>
</div>

<h3 class="mt-5 mb-3 text-info animate__animated animate__fadeInLeft">üìç Map of your location</h3>
<div id="map"></div>

<div class="mt-4 p-3 card neon animate__animated animate__fadeInUp">
  <h4 style="color: #ffffff;">üìú Event Log</h4>
  <div id="eventLog"></div>
</div>

<div class="mt-4 p-3 card neon animate__animated animate__fadeInUp">
  <h4 style="color: #ffffff;">üí¨ Chat with TerraGuard</h4>
  <div class="chat-box" id="chatBox"></div>
  <div class="input-group mt-3">
    <input type="text" id="userInput" class="form-control" placeholder="Type or speak">
    <button class="btn btn-info btn-glow" onclick="sendMessage()">Send</button>
    <button class="btn btn-warning btn-glow" onclick="startListening()">üé§ Talk</button>
  </div>
</div>

<div id="alarmLight"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
const map = L.map('map').setView([0,0],2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:"¬© OpenStreetMap"}).addTo(map);

let notificationsEnabled = false;
let alarmActive = false;

document.getElementById("notifyToggle").addEventListener("click",()=>{
  notificationsEnabled = !notificationsEnabled;
  const toggle = document.getElementById("notifyToggle");
  toggle.classList.toggle("active");
  showAlert(notificationsEnabled ? "üîî Notifications enabled" : "üîï Notifications disabled");
  if(notificationsEnabled) Notification.requestPermission();
});

const chatBox = document.getElementById("chatBox");
const input = document.getElementById("userInput");
const eventLog = document.getElementById("eventLog");
const alarmDiv = document.getElementById('alarmLight');

const icons = {
  earthquake: L.icon({iconUrl:'https://img.icons8.com/emoji/48/earthquake.png', iconSize:[40,40]}),
  fire: L.icon({iconUrl:'https://img.icons8.com/color/48/fire-element.png', iconSize:[40,40]}),
  storm: L.icon({iconUrl:'https://img.icons8.com/color/48/storm.png', iconSize:[40,40]}),
  safe: L.icon({iconUrl:'https://img.icons8.com/color/48/safe.png', iconSize:[40,40]})
};

let dangerCircles=[], eventMarkers=[];

function showAlert(msg){
  const div=document.createElement('div');
  div.className='alert alert-info alert-custom animate__animated animate__fadeInDown';
  div.innerHTML=msg;
  document.body.appendChild(div);
  setTimeout(()=>{div.remove();},4000);
}

function logEvent(text){
  const div=document.createElement('div');
  div.className='event-item';
  div.innerText=text;
  eventLog.prepend(div);
}

function sendNotification(title,message){
  if(notificationsEnabled && Notification.permission==='granted'){
    new Notification(title,{body:message});
  }
  showAlert(message);
}

function addDangerCircle(lat,lon,color,radius){
  const circle = L.circle([lat,lon],{color,fillColor:color,fillOpacity:0.5,radius}).addTo(map);
  dangerCircles.push(circle);
}

// Alarm system
function triggerAlarm(message){
  if(alarmActive) return;
  alarmActive = true;

  // Voice
  const utter = new SpeechSynthesisUtterance(message);
  utter.lang = 'en-US';
  speechSynthesis.speak(utter);

  // Flashing screen
  let colors = ['rgba(255,0,0,0.4)','rgba(0,0,255,0.4)'];
  let idx=0;
  alarmDiv.style.opacity='1';
  const flashInterval = setInterval(()=>{
    alarmDiv.style.backgroundColor = colors[idx%2];
    idx++;
  },300);

  // Siren
  const audio = new Audio('https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg');
  audio.loop=true;
  audio.play().catch(()=>console.log("User interaction required for audio"));

  // Stop button
  const stopBtn=document.createElement('button');
  stopBtn.innerText='üõë Stop Alarm';
  stopBtn.className='btn btn-danger btn-glow';
  stopBtn.style.position='fixed'; stopBtn.style.top='20px'; stopBtn.style.right='20px'; stopBtn.style.zIndex=9999;
  stopBtn.onclick=()=>{
    audio.pause();
    clearInterval(flashInterval);
    alarmDiv.style.opacity='0';
    stopBtn.remove();
    alarmActive=false;
  };
  document.body.appendChild(stopBtn);
}

function checkDangerEvent(type, mag, place){
  if((type==="earthquake" && mag>=5) || type==="fire" || type==="storm"){
    triggerAlarm(`‚ö†Ô∏è Danger! ${type.charAt(0).toUpperCase()+type.slice(1)} near ${place}. Evacuate immediately!`);
  }
}

const USGS_API="https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_hour.geojson";
let fetchTimeout=null;
function debounceFetchEarthquakes(){
  clearTimeout(fetchTimeout);
  fetchTimeout=setTimeout(fetchEarthquakes,2000);
}

async function fetchEarthquakes(){
  try{
    const res=await fetch(USGS_API);
    const data=await res.json();
    dangerCircles.forEach(c=>map.removeLayer(c));
    eventMarkers.forEach(m=>map.removeLayer(m));
    dangerCircles=[]; eventMarkers=[];
    data.features.forEach(eq=>{
      const [lon,lat]=eq.geometry.coordinates;
      const mag=eq.properties.mag;
      const place=eq.properties.place;
      const marker=L.marker([lat,lon],{icon:icons.earthquake}).addTo(map);
      marker.bindPopup(`üåé Earthquake: ${mag} mag, ${place}`);
      eventMarkers.push(marker);
      addDangerCircle(lat,lon,'red',mag*20000);
      sendNotification("‚ö†Ô∏è Earthquake",`${mag} mag, ${place}`);
      logEvent(`üåé Earthquake ‚Äî ${place} (mag: ${mag})`);
      checkDangerEvent("earthquake", mag, place);
    });
    // Example fire and storm points
    const otherEvents = [
      {lat:35.0, lon:69.5, type:"fire", place:"City A"},
      {lat:34.7, lon:70.1, type:"storm", place:"City B"}
    ];
    otherEvents.forEach(ev=>{
      const m=L.marker([ev.lat,ev.lon],{icon:icons[ev.type]}).addTo(map);
      m.bindPopup(`‚ö†Ô∏è ${ev.type.charAt(0).toUpperCase()+ev.type.slice(1)} near ${ev.place}`);
      eventMarkers.push(m);
      addDangerCircle(ev.lat, ev.lon, ev.type==="fire"?"orange":"blue",20000);
      sendNotification(`‚ö†Ô∏è ${ev.type.charAt(0).toUpperCase()+ev.type.slice(1)}`, `${ev.place}`);
      logEvent(`‚ö†Ô∏è ${ev.type.charAt(0).toUpperCase()+ev.type.slice(1)} ‚Äî ${ev.place}`);
      checkDangerEvent(ev.type, 0, ev.place);
    });
    addSafeZones();
  }catch(e){console.error(e);}
}

// Safe zones
function addSafeZones(){
  const safeZones=[
    {lat:34.8,lon:69.2,name:"üèï Safe Zone #1"},
    {lat:35.1,lon:70.0,name:"üè• Safety Medical Post"},
    {lat:34.9,lon:69.5,name:"üè´ People Shelter"}
  ];
  safeZones.forEach(s=>{
    const m=L.marker([s.lat,s.lon],{icon:icons.safe}).addTo(map);
    m.bindPopup(s.name);
    eventMarkers.push(m);
    logEvent(`‚úÖ Safe zone added: ${s.name}`);
  });
}

navigator.geolocation.getCurrentPosition(pos=>{
  const {latitude,longitude}=pos.coords;
  map.setView([latitude,longitude],6);
  L.marker([latitude,longitude]).addTo(map).bindPopup("üìç You are here").openPopup();
  debounceFetchEarthquakes();
  setInterval(debounceFetchEarthquakes,60000);
},()=>{showAlert("‚ö†Ô∏è Unable to determine your location.");});

// Chat
function sendMessage(){
  const text=input.value.trim();
  if(!text)return;
  chatBox.innerHTML+=`<div class="user-msg">üë§ ${text}</div>`;
  input.value="";
  let reply="ü§ñ I didn't understand. Try: earthquake, fire, storm, help.";
  if(/earthquake/i.test(text)) reply="üì¢ Earthquake ‚Äî stay away from buildings!";
  else if(/fire/i.test(text)) reply="üî• Fire ‚Äî evacuate and call 911!";
  else if(/storm/i.test(text)) reply="üå™Ô∏è Storm ‚Äî find shelter immediately!";
  chatBox.innerHTML+=`<div class="bot-msg">${reply}</div>`;
  chatBox.scrollTop=chatBox.scrollHeight;
  logEvent(`üí¨ User: ${text}`);
}

// Voice input
const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
recognition.lang='en-US';
recognition.interimResults=false;
recognition.onresult=event=>{
  const text=event.results[0][0].transcript;
  input.value=text;
  sendMessage();
};
function startListening(){recognition.start();}
</script>
</body>
</html>
